#!/bin/bash
set -e
eval "$($(dirname $0)/adr-config)"

## usage: adr help [COMMAND [SUBCOMMAND...]]
##
## If COMMAND and any SUBCOMMANDs are given, displays help for that command. 
## Otherwise lists the available commands.

cmds=("$@")

if (( ${#@} == 1 ))
then
	cmdexe="$adr_bin_dir/adr-$1"
elif (( ${#@} > 1 ))
then
	cmdexe="$adr_bin_dir/_adr_$(IFS=_; echo "${cmds[*]}")"
fi

if [ -z "$cmds" -o ! -x "$cmdexe" ]
then
    echo "usage: adr help COMMAND [ARG] ..."
    echo "COMMAND is one of: "
    $adr_bin_dir/_adr_commands | sed 's/^/  /'
    echo "Run 'adr help COMMAND' for help on a specific command."
else
    grep -E '^##' "$cmdexe" | cut -c 4-
	
	# Assumes only two levels of command / subcommand.
	subcmds=( $(compgen -G "$adr_bin_dir/_adr_$1_"'*') )
	
	if (( ${#subcmds} > 0 ))
	then
		echo
		echo Subcommands:
		for f in "${subcmds[@]}"
		do
			basename $f | cut -c $(( ${#1} + 7 ))-
		done | sed "s/^/  adr $1 /"
	fi
fi
